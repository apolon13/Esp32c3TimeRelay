## esp32c3-time-relay

Проект на Rust для ESP32‑C3: подключается к Wi‑Fi, получает текущее время по HTTPS и запускает периодические задачи (например, включение/выключение реле) по часам.

### Возможности
- **Wi‑Fi**: подключение к сети по заданным SSID/PASS.
- **HTTPS‑клиент**: запрос времени у внешнего API с валидацией TLS (bundle CA).
- **Планировщик задач**: запуск колбэков по заданному часу; защита от повторных срабатываний в пределах часа.
- **Таймер**: синхронный секундный тик от начального времени (на mpsc + sleep).

### Структура
- `src/main.rs`: инициализация логгера, Wi‑Fi, запрос времени, запуск планировщика с демо‑задачами.
- `src/network/wifi/`: креденшелы и подключение к Wi‑Fi (`esp-idf-svc`).
- `src/time/remote/`: HTTPS‑клиент и модель ответа времени (`api-ninjas`).
- `src/time/timer/`: простой таймер, вызывающий колбэк каждую секунду.
- `src/schedule/`: `Scheduler`, `Timer`, `PeriodicJob` и логика одноразового срабатывания в час.

### Конфигурация
Переменные окружения (используется `dotenv_codegen`):
- `SSID`: имя Wi‑Fi сети
- `PASS`: пароль Wi‑Fi
- `API_KEY`: ключ для API времени

Пример `.env` в корне:
```env
SSID=your_wifi_ssid
PASS=your_wifi_password
API_KEY=your_api_key
```

### Сборка и прошивка
Требуются ESP‑IDF и toolchain для `esp-idf-svc` (см. руководство `esp-rs`).
1. Активируйте окружение ESP‑IDF.
2. Сборка:
```bash
cargo build --release
```
3. Прошивка (пример с `cargo-espflash`):
```bash
cargo espflash flash --release --monitor
```

### Заметки
- HTTPS использует глобальное хранилище корневых сертификатов (`esp_crt_bundle_attach`).
- Демо‑задачи в `main.rs` печатают `on`/`off` на часах 19 и 20 — замените на управление реле под вашу схему.
- При отсутствующем интернете предусмотрите альтернативный источник времени или обработку ошибок запроса.

### Зависимости
`esp-idf-svc`, `embedded-svc`, `chrono`, `serde`/`serde_json`, `uuid`, `anyhow`.

### Лицензия
MIT (если не указано иное).
